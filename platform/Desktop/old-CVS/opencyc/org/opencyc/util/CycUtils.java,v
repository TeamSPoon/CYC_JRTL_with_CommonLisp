head	1.4;
access;
symbols
	BRANCH_OPENCYC_1_0_1:1.3.0.2
	OPENCYC_1_0_1:1.3
	PRE_1_0:1.1;
locks; strict;
comment	@# @;


1.4
date	2006.10.21.16.49.18;	author dmiles;	state Exp;
branches;
next	1.3;

1.3
date	2006.10.18.14.21.32;	author dmiles;	state Exp;
branches;
next	1.2;

1.2
date	2006.10.18.13.36.03;	author dmiles;	state Exp;
branches;
next	1.1;

1.1
date	2002.05.15.21.54.14;	author stephenreed;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Post OpenCyc 1.0 Cyc Java API - This includes the adding back of many exprmental packages
@
text
@/*
 * CycUtils.java
 *
 * Created on March 21, 2002, 4:54 PM
 */

package org.opencyc.util;

import java.io.IOException;
import java.util.Calendar;
import java.util.Date;
import javax.swing.SwingUtilities;
import org.opencyc.api.CycAccess;
import org.opencyc.api.CycApiException;
import org.opencyc.api.CycIOException;
import org.opencyc.api.DefaultSubLWorkerSynch;
import org.opencyc.api.SubLWorkerSynch;

/**
 * This is a placeholder class for general cyc utilities.
 * All methods in this class are static.
 * <p>
 * THIS SOFTWARE AND KNOWLEDGE BASE CONTENT ARE PROVIDED ``AS IS'' AND
 * ANY EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
 * PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE OPENCYC
 * ORGANIZATION OR ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE AND KNOWLEDGE
 * BASE CONTENT, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * @@author  tbrussea
 * @@version $Id: CycUtils.java,v 1.15 2005/07/15 17:16:36 tbrussea Exp $
 */
public class CycUtils {
    
  
  private static boolean useTiming = false;
  /*
   * Creates a new instance of CycUtils and hides it since no instances 
   * of this class need ever be made. All methods here are static. 
   */
  private CycUtils() {}
    
  /** 
   * Evaluates the given SubL expression given on the cyc image
   * provided by the CycAccess object given. Really just a thin wrapper
   * around "CycAccess.converseObject()" because I found that
   * to be a very non-intuitive method name.  Currently all
   * exceptions are caught and stack traces printed to standard
   * err. I expect that the API on this method may change in the near future
   * to throw appropriate exceptions.
   * @@param connection The CycAccess object to use for communications
   * with the appropriate Cyc image.
   * @@param subl The string that represents the SubL expression that
   * needs to be evaluated.
   * @@return The value of evaluating the passed in subl expression or
   * null if an error occurred.
   * @@deprecated use SubLWorker instead
   **/
  public static synchronized Object evalSubL(CycAccess connection, String subl) {
    Object result = null;
    try {
      if (SwingUtilities.isEventDispatchThread()) {
        throw new RuntimeException("Unable to communicate with Cyc from the AWT event dispatch thread.");
      }
      long resultMsecs = 0;
      if(useTiming) {
        resultMsecs = System.currentTimeMillis();
      }
      result = connection.converseObject(subl);
      if(useTiming) {
        System.out.println("Finished call: " + subl);
        resultMsecs = System.currentTimeMillis() - resultMsecs;
        System.out.println("Call took: " + resultMsecs + " msecs.");
      }
    } catch (IOException e) {
      throw new CycIOException(e);
    }
    return result;
  }

  
  /** 
   * Evaluates the given SubL expression given on the cyc image
   * provided by the CycAccess object given. 
   * @@param connection The CycAccess object to use for communications
   * with the appropriate Cyc image.
   * @@param subl The string that represents the SubL expression that
   * needs to be evaluated.
   * @@return The value of evaluating the passed in subl expression or
   * null if an error occurred.
   **/
  public static synchronized Object evalSubLWithWorker(final CycAccess connection, final String subl) 
    throws IOException, TimeOutException, CycApiException {
    final SubLWorkerSynch worker = new DefaultSubLWorkerSynch(subl, connection);
    return worker.getWork();
  }

  /** 
   * Resolve the value of the Symbol whose name is in the string
   * symbol.
   * @@param connection The CycAccess object to use for communications
   * with the appropriate Cyc image.
   * @@param symbol The string that represents the Symbol that
   * whose value is requested
   * @@return The value of the symbol or null if an error occurred.
   **/
  public static Object getSymbolValue(CycAccess connection, 
                                      String symbol) {
    Object result = null;
    result = evalSubL( connection, "(SYMBOL-VALUE (QUOTE " + symbol + "))");
    return result;
  }
  
  /**
   * Evalutes the given subl expression on the given Cyc image in the 
   * background. When the evaluation is complete the CycWorkerListener
   * passed to this method is notified via an event callback.
   * @@param conn The CycAccess object to use for communications
   * with the appropriate Cyc image.
   * @@param subl The string that represents the SubL expression that
   * needs to be evaluated.
   * @@param cwl The CycWorkerListener that should be notified of
   * the background tasks progress.
   * @@return The CycWorker object that is doing the work. It will be
   * either already be started.
   * @@see CycWorker
   * @@see CycWorkerListener
   * @@deprecated use SubLWorker instead
   */
  public static CycWorker evalSubLInBackground(final CycAccess conn,
					       final String subl,
					       final CycWorkerListener cwl) {
    CycWorker worker = new CycWorker() {
      public Object construct() throws Exception {
        return evalSubL(conn, subl); 
      }
    };
    if(cwl != null) { worker.addListener(cwl); }
    worker.start();
    return worker;
  }
  
  private static long SUBL_TIME_OFFSET;
  
  static {
    Calendar cal = Calendar.getInstance();
    cal.set(1900, Calendar.JANUARY, 1);
    long time = cal.getTime().getTime();
    cal.set(1970, Calendar.JANUARY, 1);
    SUBL_TIME_OFFSET = (cal.getTime().getTime() - time);
  }
  
  public static Date convertSubLTimeStampToDate(long timeStamp) {
    //@@hack the (60*60*1000) is a complete hack and should be remved once
    //we can determine why out timestamps are off by 1 hour
    return new Date((long)(timeStamp * 1000) - SUBL_TIME_OFFSET + (60 * 60 * 1000));
  }
  
}
@


1.3
log
@This is the Additional Content to Create OpenCyc-1.0.1
@
text
@@


1.2
log
@This is a checkin of OpenCyc 1.0.1 Java  OPENCYC_1_0_1
@
text
@@


1.1
log
@Initial check in.
@
text
@d9 4
d14 4
d36 1
a36 1
 * @@version $Id: CycUtils.java,v 1.1 2002/04/24 17:08:28 tbrussea Exp $
d40 2
d56 1
a56 1
   * @@param conn The CycAccess object to use for communications
d62 1
d64 1
a64 2
  public static synchronized Object evalSubL(CycAccess connection, 
					     String subl) {
d67 7
a73 1
      //System.out.println("Submitting: " + subl);
d75 7
a81 3
    } catch (Exception e) {
      System.err.println("converseString(" + subl + ") failed");
      e.printStackTrace();
d85 33
d133 1
d139 4
a142 2
	public Object construct() { return evalSubL(conn, subl); }
      };
d147 17
a163 1
    
@

